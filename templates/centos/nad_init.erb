#!/bin/bash
# chkconfig: 2345 95 20
# description: Protect yer NADZ!

PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games"

case "$1" in
  start)
  node /opt/omni/sbin/nad -c /opt/omni/etc/node-agent.d -p <%= node[:privateaddress] %>:2609 &
  ;;

  stop)
    kill -9 `ps wwwaux | grep node-agent | grep -v grep | awk '{print $2}'`
  ;;

  restart)
    $0 disable
    $0 enable
  ;;

  status)
    if [ "$(ps wwwaux | grep node-agent | grep -v grep | awk '{print $2}')" ]; then
      echo "NAD is running on PID `ps wwwaux | grep node-agent | grep -v grep | awk '{print $2}'`!"
      exit 0
    else
      exit 1
    fi
  ;;

  *)
    echo "Usage: /etc/init.d/nad {start|stop|restart|status}"
    exit 1
  ;;
esac

exit 0
